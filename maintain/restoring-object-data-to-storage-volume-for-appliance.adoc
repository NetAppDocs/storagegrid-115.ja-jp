---
permalink: maintain/restoring-object-data-to-storage-volume-for-appliance.html 
sidebar: sidebar 
keywords: storagegrid, recover, appliance, appliance storage volume, restore object data 
summary: アプライアンスストレージノードのストレージボリュームをリカバリしたら、ストレージノードの障害で失われたオブジェクトデータをリストアできます。 
---
= アプライアンスのストレージボリュームへのオブジェクトデータのリストア
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
アプライアンスストレージノードのストレージボリュームをリカバリしたら、ストレージノードの障害で失われたオブジェクトデータをリストアできます。

.必要なもの
* リカバリされたストレージノードの接続状態が * connected * であることを確認しておく必要がありますimage:../media/icon_alert_green_checkmark.png["アイコンアラートの緑のチェックマーク"] Grid Managerの* Nodes *>* Overview *タブ。


.このタスクについて
グリッドの ILM ルールがオブジェクトコピーを作成するように設定されていた場合、他のストレージノード、アーカイブノード、またはクラウドストレージプールからオブジェクトデータをリストアできます。


IMPORTANT: レプリケートされたコピーを 1 つだけ保存するように ILM ルールが設定されていて、そのコピーがストレージボリュームに障害が発生した場合、オブジェクトをリカバリすることはできません。


IMPORTANT: オブジェクトのコピーがクラウドストレージプールにしか残っていない場合、 StorageGRID は、オブジェクトデータをリストアするために複数の要求をクラウドストレージプールエンドポイントに問題 する必要があります。この手順 を実行する前に、テクニカルサポートに問い合わせて、リカバリ期間と関連コストの見積もりを依頼してください。


NOTE: オブジェクトのコピーがアーカイブノードにしか残っていない場合は、アーカイブノードからオブジェクトデータが読み出されます。外部アーカイブストレージシステムからの読み出しには遅延が伴うため、アーカイブノードからストレージノードへのオブジェクトデータのリストアには、他のストレージノードからコピーをリストアする場合に比べて時間がかかります。

オブジェクトデータをリストアするには、を実行します `repair-data` スクリプト：このスクリプトは、オブジェクトデータのリストアプロセスを開始し、 ILM スキャンと連動して ILM ルールを適用します。では、さまざまなオプションを使用します `repair-data` 次の方法で、レプリケートデータとイレイジャーコーディングデータのどちらをリストアするかに基づくスクリプトです。

* *レプリケートデータ*：レプリケートデータをリストアするコマンドは、ノード全体を修復するのか、ノード上の一部のボリュームのみを修復するのかに応じて2つあります。
+
[listing]
----
repair-data start-replicated-node-repair
----
+
[listing]
----
repair-data start-replicated-volume-repair
----
* *イレイジャーコーディング（EC）データ*：イレイジャーコーディングデータをリストアするコマンドは、ノード全体を修復するのか、ノード上の一部のボリュームのみを修復するのかに応じて2つあります。
+
[listing]
----
repair-data start-ec-node-repair
----
+
[listing]
----
repair-data start-ec-volume-repair
----
+
イレイジャーコーディングデータの修復は、一部のストレージノードがオフライン状態で開始できます。修復はすべてのノードが使用可能になったあとに完了します。次のコマンドを使用して、イレイジャーコーディングデータの修復を追跡できます。

+
[listing]
----
repair-data show-ec-repair-status
----



NOTE: EC 修復ジョブによって、大量のストレージが一時的にリザーブされます。ストレージアラートがトリガーされることもありますが、修復が完了すると解決します。予約に必要なストレージが不足していると、 EC の修復ジョブが失敗します。ストレージリザベーションは、ジョブが失敗したか成功したかに関係なく、 EC 修復ジョブが完了すると解放されます。

を使用する方法の詳細については、を参照してください `repair-data` スクリプトを入力します `repair-data --help` プライマリ管理ノードのコマンドラインを使用します。

.手順
. プライマリ管理ノードにログインします。
+
.. 次のコマンドを入力します。 `ssh admin@_primary_Admin_Node_IP_`
.. に記載されているパスワードを入力します `Passwords.txt` ファイル。
.. 次のコマンドを入力してrootに切り替えます。 `su -`
.. に記載されているパスワードを入力します `Passwords.txt` ファイル。
+
rootとしてログインすると、プロンプトがから変わります `$` 終了： `#`。



. を使用します `/etc/hosts` リストアされたストレージボリュームのストレージノードのホスト名を特定するファイル。グリッド内のすべてのノードのリストを表示するには、次のように入力します。 `cat /etc/hosts`
. すべてのストレージボリュームで障害が発生した場合は、ノード全体を修復します。（一部のボリュームだけで障害が発生した場合は、次の手順に進みます）。
+

IMPORTANT: を実行できません `repair-data` 複数のノードに対して同時に処理を実行すること。複数のノードをリカバリする場合は、テクニカルサポートにお問い合わせください。

+
** グリッドにレプリケートデータがある場合は、を使用します `repair-data start-replicated-node-repair` コマンドにを指定します `--nodes` ストレージノード全体を修復するオプションです。
+
次のコマンドは、 SG-DC-SN3 というストレージノードにあるレプリケートデータを修復します。

+
[listing]
----
repair-data start-replicated-node-repair --nodes SG-DC-SN3
----
+

NOTE: オブジェクトデータのリストア時、 StorageGRID システムがレプリケートされたオブジェクトデータを見つけられない場合は、 * Objects lost * アラートがトリガーされます。システム全体のストレージノードでアラートがトリガーされることがあります。損失の原因 と、リカバリが可能かどうかを確認する必要があります。StorageGRID の監視とトラブルシューティングの手順を参照してください。

** グリッドにイレイジャーコーディングデータがある場合は、を使用します `repair-data start-ec-node-repair` コマンドにを指定します `--nodes` ストレージノード全体を修復するオプションです。
+
次のコマンドは、SG-DC-SN3というストレージノードにあるイレイジャーコーディングデータを修復します。

+
[listing]
----
repair-data start-ec-node-repair --nodes SG-DC-SN3
----
+
一意のが返されます `repair ID` これを識別します `repair_data` 操作。これを使用します `repair ID` をクリックして、の進捗状況と結果を追跡します `repair_data` 操作。リカバリプロセスが完了しても、それ以外のフィードバックは返されません。

+

NOTE: イレイジャーコーディングデータの修復は、一部のストレージノードがオフライン状態で開始できます。修復はすべてのノードが使用可能になったあとに完了します。

** グリッドにレプリケートデータとイレイジャーコーディングデータの両方がある場合は、両方のコマンドを実行します。


. 一部のボリュームだけで障害が発生した場合は、影響を受けたボリュームを修復します。
+
ボリューム ID を 16 進数で入力します。例： `0000` は、最初のボリュームとです `000F` 16番目のボリュームです。1 つのボリューム、一連のボリューム、または連続していない複数のボリュームを指定できます。

+
すべてのボリュームが同じストレージノードにある必要があります。複数のストレージノードのボリュームをリストアする必要がある場合は、テクニカルサポートにお問い合わせください。

+
** グリッドにレプリケートデータがある場合は、を使用します `start-replicated-volume-repair` コマンドにを指定します `--nodes` ノードを識別するオプション。次に、を追加します `--volumes` または `--volume-range` 次の例に示すように、オプションを指定します。
+
*単一ボリューム*：レプリケートされたデータをボリュームにリストアします `0002` SG-DC-SN3という名前のストレージノードで次のように設定します。

+
[listing]
----
repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volumes 0002
----
+
*ボリューム範囲*：レプリケートされたデータを範囲内のすべてのボリュームにリストアします `0003` 終了： `0009` SG-DC-SN3という名前のストレージノードで次のように設定します。

+
[listing]
----
repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volume-range 0003-0009
----
+
*複数のボリュームが連続していません*：このコマンドは、複製されたデータをボリュームにリストアします `0001`、 `0005`および `0008` SG-DC-SN3という名前のストレージノードで次のように設定します。

+
[listing]
----
repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volumes 0001,0005,0008
----
+

NOTE: オブジェクトデータのリストア時、 StorageGRID システムがレプリケートされたオブジェクトデータを見つけられない場合は、 * Objects lost * アラートがトリガーされます。システム全体のストレージノードでアラートがトリガーされることがあります。損失の原因 と、リカバリが可能かどうかを確認する必要があります。StorageGRID の監視とトラブルシューティングの手順を参照してください。

** グリッドにイレイジャーコーディングデータがある場合は、を使用します `start-ec-volume-repair` コマンドにを指定します `--nodes` ノードを識別するオプション。次に、を追加します `--volumes` または `--volume-range` 次の例に示すように、オプションを指定します。
+
*単一ボリューム*：イレイジャーコーディングされたデータをボリュームにリストアします `0007` SG-DC-SN3という名前のストレージノードで次のように設定します。

+
[listing]
----
repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volumes 0007
----
+
*ボリューム範囲*：イレイジャーコーディングされたデータを範囲内のすべてのボリュームにリストアします `0004` 終了： `0006` SG-DC-SN3という名前のストレージノードで次のように設定します。

+
[listing]
----
repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volume-range 0004-0006
----
+
*複数のボリュームが連続していません*：このコマンドはイレイジャーコーディングされたデータをボリュームにリストアします `000A`、 `000C`および `000E` SG-DC-SN3という名前のストレージノードで次のように設定します。

+
[listing]
----
repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volumes 000A,000C,000E
----
+
。 `repair-data` 一意のが返されます `repair ID` これを識別します `repair_data` 操作。これを使用します `repair ID` をクリックして、の進捗状況と結果を追跡します `repair_data` 操作。リカバリプロセスが完了しても、それ以外のフィードバックは返されません。

+

NOTE: イレイジャーコーディングデータの修復は、一部のストレージノードがオフライン状態で開始できます。修復はすべてのノードが使用可能になったあとに完了します。

** グリッドにレプリケートデータとイレイジャーコーディングデータの両方がある場合は、両方のコマンドを実行します。


. レプリケートデータの修復を監視します。
+
.. 「* Nodes *>* Storage Node being repaired *>* ILM *」を選択します。
.. 「評価」セクションの属性を使用して、修理が完了したかどうかを判断します。
+
修復が完了すると、Awaiting - All属性は0個のオブジェクトを示します。

.. 修復の詳細を監視するには、* Support *>* Tools *>* Grid Topology *を選択します。
.. 「* grid *>* Storage Node being repaired *>* LDR *>* Data Store *」を選択します。
.. 次の属性を組み合わせて、レプリケートデータの修復が完了したかどうかを可能なかぎり判別します。
+

NOTE: Cassandra に不整合が生じている可能性があり、また、失敗した修復は追跡されません。

+
*** * Repairs Attempted （ XRPA ） * ：レプリケートデータの修復の進行状況を追跡します。この属性は、ストレージノードがハイリスクオブジェクトの修復を試みるたびに値が増分します。この属性の値が現在のスキャン期間（ * Scan Period - - Estimated * 属性で指定）よりも長い期間にわたって上昇しない場合、 ILM スキャンはすべてのノードで修復が必要なハイリスクオブジェクトを検出していません。
+

NOTE: ハイリスクオブジェクトとは、完全に失われる危険があるオブジェクトです。ILM 設定を満たしていないオブジェクトは含まれません。

*** * スキャン期間 - 推定（ XSCM ） * ：この属性を使用して、以前に取り込まれたオブジェクトにポリシー変更が適用されるタイミングを見積もります。「 * Repairs Attempted * 」属性が現在のスキャン期間よりも長くなっていない場合は、複製修復が実行されている可能性があります。スキャン期間は変わる可能性があるので注意してください。* Scan Period - - Estimated （ XSCM ） * 属性は、グリッド全体の環境 を示します。これは、すべてのノードのスキャン期間の最大値です。グリッドの * Scan Period - - Estimated * 属性履歴を照会して、適切な期間を判断できます。




. イレイジャーコーディングデータの修復を監視し、失敗した可能性のある要求を再試行します。
+
.. イレイジャーコーディングデータの修復ステータスを確認します。
+
*** 特定のののステータスを表示するには、このコマンドを使用します `repair-data` 操作：
+
[listing]
----
repair-data show-ec-repair-status --repair-id repair ID
----
*** すべての修復処理を表示するには、次のコマンドを使用します
+
[listing]
----
repair-data show-ec-repair-status
----
+
出力には、などの情報が表示されます `repair ID`以前に、現在実行中のすべての修復。

+
[listing]
----
root@DC1-ADM1:~ # repair-data show-ec-repair-status

Repair ID Scope Start Time  End Time  State  Est Bytes Affected/Repaired Retry Repair
=====================================================================================
 949283 DC1-S-99-10(Volumes: 1,2) 2016-11-30T15:27:06.9 Success 17359 17359 No
 949292 DC1-S-99-10(Volumes: 1,2) 2016-11-30T15:37:06.9 Failure 17359 0     Yes
 949294 DC1-S-99-10(Volumes: 1,2) 2016-11-30T15:47:06.9 Failure 17359 0     Yes
 949299 DC1-S-99-10(Volumes: 1,2) 2016-11-30T15:57:06.9 Failure 17359 0     Yes
----


.. 失敗した修復処理が出力された場合は、を使用します `--repair-id` 修復を再試行するオプションです。
+
このコマンドは、修復IDを使用して、障害が発生したノードの修復を再試行します `83930030303133434`：

+
[listing]
----
repair-data start-ec-node-repair --repair-id 83930030303133434
----
+
このコマンドは、修復IDを使用して、障害が発生したボリュームの修復を再試行します `83930030303133434`：

+
[listing]
----
repair-data start-ec-volume-repair --repair-id 83930030303133434
----




.関連情報
link:../monitor/index.html["トラブルシューティングを監視します"]
